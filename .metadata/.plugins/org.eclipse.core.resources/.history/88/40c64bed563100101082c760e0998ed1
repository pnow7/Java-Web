<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="tb_api.*, tb_api.TbDTO.*, java.util.List" %>
<%
    // 로직 구현
    List<TbDTO.BusLocation> items = null;
    
    String serviceKey = "meXac76uoVH%2B6SQfe83GH07q8hu5R%2BTj8AH0alKd3ITyDxlBz22mzP6iGhWjHv0oBAd27SsgtxmVB1RkoFT9sw%3D%3D";
    String srcUrl = "https://apis.data.go.kr/6410000/buslocationservice/v2/getBusLocationListv2";
    
    try {
        Class<TbDTO> dto = TbDTO.class;
        TbDTO data = (TbDTO)ApiExplorer.getApiJsonData(serviceKey, srcUrl, dto);
        
        if (data.getResponse().getMsgBody().getBusLocationList().size() > 0) {
            items = data.getResponse().getMsgBody().getBusLocationList();
        }        
                
    } catch(Exception e) {
        System.out.println(e.getMessage());
    }
    
    
%>    
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>경기도 버스도착 정보</title>
</head>

<body>
<% if(items != null && !items.isEmpty()) { %>
    <table border='1'>
        <thead>
            <tr>    
                <th>crowded</th>
                <th>lowPlate</th>
                <th>번호판</th>
                <th>남은좌석수</th>
                <th>루트아이디</th>
                <th>루트타입</th>
                <th>상태</th>
                <th>역아이디</th>
                <th>역순서</th>
                <th>태글</th>
                <th>운송아이디</th>
            </tr>
        </thead>
        <tbody>
        <% for(BusLocation item: items) { %>
            <tr>
                <td><%= item.getCrowded() %></td>
                <td><%= item.getLowPlate() %></td>
                <td><%= item.getPlateNo() %></td>
                <td><%= item.getRemainSeatCnt() %></td>
                <td><%= item.getRouteId() %></td>
                <td><%= item.getRouteTypeCd() %></td>
                <td><%= item.getStateCd() %></td>
                <td><%= item.getStationId() %></td>
                <td><%= item.getStationSeq() %></td>
                <td><%= item.getTaglessCd() %></td>
                
                <td><%= item.getVehId() %></td>
            </tr>
        <% } %>
        </tbody>
    </table>
<% } else { %>
    <p>데이터가 없거나 로드하는 중 오류가 발생했습니다 </p>
<% } %>



</body>
</html>